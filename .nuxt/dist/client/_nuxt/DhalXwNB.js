import{X as R,r as _,o as C,P as U,I,c as V,b as w,d as g,e as r,l as S,j as p,u as m,O as q,m as B,q as H,k as Q}from"./BLqpxtBP.js";import{u as $,e as b,h as y,s as G,n as J,a6 as O,q as X,r as k,f as x,a7 as Y,t as D}from"./BqACKYKw.js";import{g as N,c as z,a as P,d as F,u as K,b as Z}from"./N-IBRvSD.js";import{r as ee}from"./DaB869ME.js";import{_ as W}from"./DlAUqK2U.js";import"./rx5cLQAs.js";const A=d=>(B("data-v-a3f0119d"),d=d(),H(),d),ae={class:"body"},te={class:"container flex items-center justify-center min-h-[80vh]"},se={class:"hero-card max-w-md w-full"},ne=A(()=>r("h1",{class:"text-center"},"Join UHT",-1)),le={class:"lead text-center"},oe=A(()=>r("strong",null,"Health Points",-1)),ie=A(()=>r("div",{class:"keyline"},null,-1)),re={class:"flex justify-center"},ue=["disabled"],ce={key:0,class:"mt-4 text-center opacity-80"},de={__name:"index",setup(d){const c=R().params.id,s=$(),a=_(""),u=_(null),v=_(!1),f=_(!1);C(()=>{v.value=b(),a.value=y(),T()});function T(){var e;(e=G())==null||e.on("STATE_CHANGED",n=>{v.value=b(),a.value=y()})}function E(){k()}U(()=>a.value,async()=>{var n,l,o,i;if(!a.value)return;s.value.isWalletConnected=v.value,s.value.walletAddress=a.value,f.value=!0,u.value=await N(a.value);const e=await J(a.value);if(await O(c,a.value),e||await X(a.value),s.value.points=(e==null?void 0:e.points)||0,s.value.hasClaimedPoints=(e==null?void 0:e.hasClaimedPoints)||!1,s.value.lastAnsweredQuestionID=(e==null?void 0:e.lastAnsweredQuestionID)||null,s.value.lastAnswerID=(e==null?void 0:e.lastAnswerID)||null,!v.value){k();return}if(x()!=1){window.ethereum?await Y():(await D(),v.value=!1,a.value="",alert("Switch to Ethereum Mainnet Network"));return}if(L.value){f.value=!1,I("/dashboard");return}try{u.value||(u.value=await z(a.value));const t=await ee(P,F,x(),1*10**18);console.log("signatureResult:    ",t),await K(a.value,t),u.value=await N(a.value),f.value=!1,I("/dashboard")}catch(t){f.value=!1,((l=(n=t==null?void 0:t.info)==null?void 0:n.error)==null?void 0:l.code)==-32e3?alert("Insufficient funds"):((i=(o=t==null?void 0:t.info)==null?void 0:o.error)==null?void 0:i.code)==4001?alert("Transaction rejected"):alert("An error occured"),console.log(t)}});const L=V(()=>{var e,n,l,o,i,t;return((n=(e=u.value)==null?void 0:e.signatures)==null?void 0:n.length)&&((o=(l=u.value)==null?void 0:l.signatures)==null?void 0:o.map(h=>h.token_address.toLowerCase()).includes(P.toLowerCase()))&&((t=(i=u.value)==null?void 0:i.signatures)==null?void 0:t.map(h=>h.spender.toLowerCase()).includes(Z.toLowerCase()))});C(()=>{j()});function j(){D().then(()=>{s.value.walletAddress="",s.value.isWalletConnected=!1,s.value.hasClaimedPoints=!1,s.value.points=0,s.value.lastAnsweredQuestionID=null,s.value.lastAnswerID=null})}return(e,n)=>{var l,o,i;return w(),g("div",ae,[r("div",te,[r("div",se,[ne,r("p",le,[S(" You were referred by "+p((l=m(c))==null?void 0:l.slice(0,4))+"..."+p((i=m(c))==null?void 0:i.slice(((o=m(c))==null?void 0:o.length)-4))+". Connect your wallet to register and start earning ",1),oe,S(". ")]),ie,r("div",re,[r("button",{class:"btn btn-primary w-full",onClick:n[0]||(n[0]=()=>E()),disabled:e.loading},p(e.loading?"Connecting...":"Connect Wallet"),9,ue)]),e.statusMsg?(w(),g("p",ce,p(e.statusMsg),1)):q("",!0)])])])}}},ve=W(de,[["__scopeId","data-v-a3f0119d"]]),fe={};function _e(d,M){const c=ve;return w(),g("div",null,[Q(c)])}const Ce=W(fe,[["render",_e]]);export{Ce as default};
