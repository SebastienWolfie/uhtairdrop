import{_ as je}from"./CohZIaU4.js";import{u as Be,g as Pe,a as Ye,a4 as qe,D as Ze}from"./BqACKYKw.js";import{s as O}from"./C7Qv54Es.js";import{r as d,V as Qe,P as j,o as oe,c as F,Q as ke,b as v,d as f,k as ge,e as o,O as A,S as ne,R as B,j as r,l as _,M as Ge,N as Ke,T as he,n as we,u as se,W as Je,U as Xe,m as et,q as tt}from"./BLqpxtBP.js";import{_ as ye}from"./B0PwvC0I.js";import{g as _e,c as at,d as ot}from"./DjOLoqGw.js";import{t as nt,m as st}from"./zGrFUsMF.js";import{l as lt}from"./5N9_71eC.js";import{g as pe,c as it}from"./BFRmLPsM.js";import{_ as Se}from"./DlAUqK2U.js";import"./CigPq3WD.js";import"./N-IBRvSD.js";import"./rx5cLQAs.js";const V=R=>(et("data-v-91a7c93f"),R=R(),tt(),R),ct={class:"body"},rt={class:"container"},ut={class:"section-header"},dt=V(()=>o("div",{class:"uht-mark"},[o("img",{src:ye,alt:"Stake Logo",onerror:"this.src='https://dummyimage.com/96x96/6a44ff/ffffff&text=UHT'"}),o("div",null,[o("div",{class:"brand-title"},"Stake UHT"),o("span",{class:"badge"},[o("small",null,"Stake Your Tokens â€¢ Earn Hash Rate")])])],-1)),vt=V(()=>o("button",{class:"info-btn","aria-label":"Staking help"},"?",-1)),ft={key:0,class:"info-tooltip"},mt=V(()=>o("strong",null,"Quick guide",-1)),kt=V(()=>o("div",{style:{"margin-top":"6px","font-size":"13px"}},[_(" Flexible stakes are temporarily locked for "),o("strong",null,"24 hours"),_(" after staking. Locked stakes remain locked for "),o("strong",null,"30 days"),_(". Withdraw becomes available after the unlock time. ")],-1)),ht=[mt,kt],wt={key:0,class:"coming-soon"},_t={key:0,class:"locked-alert"},pt={class:"staking-tabs"},bt=V(()=>o("div",{class:"inline-explain",style:{"margin-bottom":"12px",color:"rgba(255,255,255,0.85)","font-size":"13px"}},[o("strong",null,"Note:"),_(' Flexible stakes will be labeled "Flexible" but will be withdrawable only after '),o("strong",null,"24 hours"),_(". Locked stakes are withdrawable after "),o("strong",null,"30 days"),_(". ")],-1)),gt={key:1,class:"text-red-400 font-semibold my-2"},yt={class:"stake-card"},St={class:"stake-info"},Tt={class:"stake-action"},xt=["max"],Dt=["disabled"],Mt={class:"stakes-list"},At=["onMouseenter"],Vt={class:"stake-type"},It={class:"stake-amount"},Nt={key:0,class:"stake-unlock"},Et={key:1,class:"unlock-countdown",style:{"margin-top":"6px","font-size":"13px",color:"#ffd1d1"}},$t={class:"stake-actions"},Rt=["onClick","disabled"],Ut={class:"hashrate-bar","aria-hidden":""},Ct=Xe('<header class="section-header mt-12" data-v-91a7c93f><div class="uht-mark" data-v-91a7c93f><img src="'+ye+'" alt="UHT Logo" data-v-91a7c93f><div data-v-91a7c93f><div class="brand-title" data-v-91a7c93f>Vote for the UHT mascot</div><span class="badge" data-v-91a7c93f><small data-v-91a7c93f>Community Voting</small></span></div></div></header>',1),Lt={class:"meta-row"},Ht={key:0},Ft={key:1},Wt={key:2,class:"ended"},zt={class:"nft-list"},Ot=["onMouseenter"],jt={class:"row-left"},Bt=["src"],Pt={class:"nft-meta"},Yt={class:"nft-name"},qt={key:0,class:"you-voted-badge"},Zt={class:"nft-votes"},Qt={class:"progress-bar small"},Gt={class:"row-right"},Kt={class:"supply"},Jt=["onClick","disabled"],Xt=V(()=>o("footer",{class:"page-footer"}," Â© 2025 UHT â€¢ Universal Health Token â€” Stake & Vote Together. ",-1)),ea={class:"modal"},ta=V(()=>o("h3",null,"Confirm withdrawal",-1)),aa={key:0,class:"warning"},oa={key:1,class:"text-green-300"},na={class:"modal-actions"},sa=["disabled"],be=18e3,P=264831,la={__name:"index",setup(R){const h=Be(),Y=d(!0),q=d(!1),I=d(-1),y=d(""),i=Qe({walletAddress:"",balance:0,flexibleStaked:0,lockedStaked:0,hashRate:0,isLocked:!1}),m=d(0),T=d("flexible"),p=d([]),Z=d(-1),Q=d(!1);j(()=>[h.value.walletAddress,h.value.uhtbalance],le),j(()=>m.value,()=>y.value=""),oe(()=>{le()});async function le(){var t,s;i.walletAddress=h.value.walletAddress,i.balance=Number(((s=(t=h.value.uhtbalance)==null?void 0:t.toFixed)==null?void 0:s.call(t,2))??0),i.hashRate=0;const e=await _e(h.value.walletAddress)||[];p.value=e.map(a=>{let n=null;if(a.start){const l=new window.Date(a.start).getTime();a.type==="locked"?n=l+30*24*60*60*1e3:a.type==="flexible"&&(n=l+24*60*60*1e3)}return{...a,unlockReady:!a.start||!n?a.type==="flexible":window.Date.now()>=n,unlockDate:n?new window.Date(n).toString():null}}),i.flexibleStaked=p.value.filter(a=>a.type==="flexible").reduce((a,n)=>a+n.amount,0),i.lockedStaked=p.value.filter(a=>a.type==="locked").reduce((a,n)=>a+n.amount,0),i.balance=Math.max(0,i.balance-(i.flexibleStaked+i.lockedStaked))}const Te=F(()=>T.value==="flexible"?i.flexibleStaked:i.lockedStaked),xe=F(()=>{const e=i.balance+i.flexibleStaked+i.lockedStaked||1;return(Te.value+m.value)/e*100});async function De(){var e,t,s,a,n,l,u;if(!(m.value<=0||m.value>i.balance))try{q.value=!0,await nt(m.value);const c={type:T.value,amount:m.value,address:h.value.walletAddress,start:new window.Date().toISOString()},k=await at(c),b={...c,id:(k==null?void 0:k.id)??c.id??(Math.random()+Ze.now()).toString()},L=new window.Date(b.start).getTime(),H=b.type==="locked"?L+30*24*60*60*1e3:L+24*60*60*1e3;b.unlockDate=new window.Date(H).toString(),b.unlockReady=window.Date.now()>=H,p.value.push(b),T.value==="flexible"?i.flexibleStaked+=m.value:i.lockedStaked+=m.value,i.balance=Math.max(0,i.balance-m.value),m.value=0}catch(c){((t=(e=c==null?void 0:c.info)==null?void 0:e.error)==null?void 0:t.code)==-32e3||((s=c==null?void 0:c.error)==null?void 0:s.code)==-32046?y.value="Slippage tolerance high. Add Eth to cover gwei charge":((n=(a=c==null?void 0:c.info)==null?void 0:a.error)==null?void 0:n.code)==4001||((u=(l=c==null?void 0:c.info)==null?void 0:l.error)==null?void 0:u.code)==5e3?y.value="Transaction rejected":y.value="An error occurred",console.log(c)}finally{q.value=!1}}const N=d(-1),G=d(0),K=d(null),J=d(!1),Me=F(()=>N.value!==-1);function Ae(e){const t=p.value[e];if(!t)return;const s=t.start?new window.Date(t.start).getTime():null,a=s?t.type==="locked"?s+30*24*60*60*1e3:s+24*60*60*1e3:null,n=a?window.Date.now()>=a:t.type==="flexible";N.value=e,G.value=t.amount,K.value=t.type,J.value=n}function W(){N.value=-1,G.value=0,K.value=null,J.value=!1}async function Ve(){var n,l,u,c,k,b,L,H;const e=N.value;if(e===-1)return;const t=p.value[e],s=t.start?new window.Date(t.start).getTime():null,a=s?t.type==="locked"?s+30*24*60*60*1e3:s+24*60*60*1e3:null;if(a&&window.Date.now()<a){alert("Stake not yet unlocked."),W();return}try{I.value=e,await st(t.amount,2e-5),i.balance+=t.amount,t.type==="flexible"?i.flexibleStaked-=t.amount:i.lockedStaked-=t.amount,await ot(t.id),p.value.splice(e,1)}catch(w){((l=(n=w==null?void 0:w.info)==null?void 0:n.error)==null?void 0:l.code)==-32e3||((c=(u=w==null?void 0:w.info)==null?void 0:u.error)==null?void 0:c.code)==-32046?y.value="Slippage tolerance high. Add Eth to cover gwei charge":((b=(k=w==null?void 0:w.info)==null?void 0:k.error)==null?void 0:b.code)==4001||((H=(L=w==null?void 0:w.info)==null?void 0:L.error)==null?void 0:H.code)==5e3?y.value="Transaction rejected":y.value="An error occured",console.log(w)}finally{I.value=-1,W()}}const U=new window.Date("2025-10-07T12:00:00Z"),X=new window.Date("2025-10-08T22:00:00Z"),ee=new window.Date("2025-10-07T12:00:00Z"),ie=new window.Date("2025-10-10T12:00:00Z"),Ie=["nft3","nft1","nft6","nft2","nft5","nft4","nft7","nft8","nft10","nft11"],Ne=[9,8,7,6,5,4,3,2,1,1],g=d([]),x=d(!1),D=d(null),E=d(!1),z=d(new window.Date),$=d({amount:0,type:null}),ce=F(()=>{const e=g.value.reduce((t,s)=>t+(Number(s.votes)||0),0);return isNaN(e)?0:e}),Ee=F(()=>Number($.value.amount)>=10&&!E.value);let S=null,M=null;const re=d(null);oe(async()=>{await ue()}),j(()=>h.value.walletAddress,()=>ue());async function ue(){await $e();const e=await pe(h.value.walletAddress);e!=null&&e.nft&&(x.value=!0,D.value=e.nft),await de(),We(),Oe();const s=O(()=>z.value=new window.Date,1e3);ke(()=>{clearInterval(s),S&&clearInterval(S),M&&clearInterval(M)})}j(()=>h.value.walletAddress,async()=>{const e=await pe(h.value.walletAddress);e!=null&&e.nft?(x.value=!0,D.value=e.nft):(x.value=!1,D.value=null),await de()});async function de(){const e=await _e(h.value.walletAddress)||[];if(!Array.isArray(e))return;const t=e.reduce((a,n)=>a+(n.amount||0),0),s=e.length?e[e.length-1].type:null;$.value={amount:t,type:s}}async function $e(){g.value=Ie.map((e,t)=>{const s=lt.find(n=>n.id===e)||{id:e,name:`NFT ${e}`,img:""},a=Math.floor(Math.random()*3e3+500);return{...s,votes:a,available:s.available??0,initialAvailable:s.available??0,projectedFloor:te(a,P),orderWeight:Ne[t]??1,percent:0}}),ae()}function te(e,t){const a=(Number(e)||0)/Math.max(Number(t)||1,1);return .15*(1+Math.sqrt(a)*6)}function ae(){const e=P;g.value.forEach(t=>{const s=Number(t.votes)||0;t.percent=s/e*100,t.projectedFloor=te(s,e)})}function Re(e){return isNaN(e.percent)?"0%":e.percent.toFixed(2)+"%"}function ve(e){const t=Math.floor(e/1e3),s=Math.floor(t/3600),a=Math.floor(t%3600/60),n=t%60;return`${s}h ${a}m ${n}s`}function Ue(e){const t=p.value[e];if(!t||!t.unlockDate)return"N/A";const s=window.Date.now(),a=new window.Date(t.unlockDate).getTime(),n=Math.max(0,a-s),l=Math.floor(n/1e3),u=Math.floor(l/3600),c=Math.floor(l%3600/60),k=l%60;return`${u}h ${c}m ${k}s`}let C=null;function Ce(){C&&clearInterval(C),C=O(()=>{p.value.forEach((e,t)=>{if(!e.start)return;const s=new window.Date(e.start).getTime(),a=e.type==="locked"?s+30*24*60*60*1e3:s+24*60*60*1e3,n=window.Date.now()>=a;e.unlockReady!==n&&(e.unlockReady=n),e.unlockDate=new window.Date(a).toString()})},1e3)}oe(Ce),ke(()=>{C&&clearInterval(C)});async function Le(e){if(x.value||E.value)return;const t=Number($.value.amount||0),s=$.value.type;if(t<10){alert("Minimum 10 UHT stake required to vote. Stake via the Stake section above.");return}const a=Math.max(1,Math.round(t*(s==="locked"?1:.5))),n=g.value.find(l=>l.id===e);n&&(n.votes+=a,ae(),x.value=!0,D.value=e,await it(h.value.walletAddress,{nft:e,address:h.value.walletAddress}))}function He(e){return x.value?D.value===e?"You Voted":"Voting Locked":"Vote"}function Fe(e){return e<0?0:e>1?1:1-(1-e)*(1-e)}function We(){S&&clearInterval(S),fe(),S=O(()=>fe(),5e3)}function fe(){const e=new window.Date;if(e<U)return;if(e>=X){S&&clearInterval(S),E.value=!0,ze();return}const t=X-U,s=e-U,a=Math.min(s/t,1),n=be+(P-be)*Fe(a),l=ce.value,u=Math.max(0,Math.round(n-l));if(u<=0)return;const c=g.value.reduce((k,b)=>k+(b.orderWeight||1),0);g.value.forEach(k=>{const b=Math.round(u*((k.orderWeight||1)/c)*(.9+Math.random()*.2));k.votes+=b,k.projectedFloor=te(k.votes,P)}),ae()}async function ze(){var s,a,n;S&&clearInterval(S),E.value=!0;const t=[...g.value].sort((l,u)=>u.votes-l.votes).slice(0,3);try{const l=Pe(Ye,"uht_results","final_2026");await qe(l,{finalizedAt:new window.Date().toISOString(),top3:t.map(u=>({id:u.id,name:u.name,votes:u.votes}))})}catch(l){console.warn("Could not write final results",l)}alert(`Voting ended! ðŸ
1) ${(s=t[0])==null?void 0:s.name}
2) ${(a=t[1])==null?void 0:a.name}
3) ${(n=t[2])==null?void 0:n.name}`)}function Oe(){M&&clearInterval(M),me(),M=O(()=>me(),5e3)}function me(){const e=new window.Date;if(e<ee)return;if(e>=ie){M&&clearInterval(M),g.value.forEach(l=>l.available=Math.max(0,Math.floor(l.available)));return}const t=ie-ee,s=e-ee,a=Math.min(s/t,1),n=1-Math.pow(1-a,2);g.value.forEach(l=>{const u=Math.round((l.initialAvailable||0)*(1-n));l.available=Math.max(0,u)})}return(e,t)=>{const s=je;return v(),f("div",ct,[ge(s,{class:"md:mx-[10%] mx-[2%] sticky top-[10px] z-50"}),o("div",rt,[o("header",ut,[dt,o("div",{class:"info-wrapper",onMouseenter:t[0]||(t[0]=a=>Q.value=!0),onMouseleave:t[1]||(t[1]=a=>Q.value=!1)},[vt,Q.value?(v(),f("div",ft,ht)):A("",!0)],32)]),Y.value?(v(),f(ne,{key:1},[i.isLocked?(v(),f("section",_t," âš ï¸ Your account has been locked due to rule violation. ")):A("",!0),o("div",pt,[o("button",{class:B(["tab-btn",{active:T.value==="flexible"}]),onClick:t[2]||(t[2]=a=>T.value="flexible")}," Flexible (24 hours) ",2),o("button",{class:B(["tab-btn",{active:T.value==="locked"}]),onClick:t[3]||(t[3]=a=>T.value="locked")}," Locked (30 Days) ",2)]),bt,y.value?(v(),f("p",gt,r(y.value),1)):A("",!0),o("section",yt,[o("div",St,[o("p",null,[_("Balance: "),o("strong",null,r(i.balance)+" UHT",1)]),o("p",null,[_("Staked (flexible): "),o("strong",null,r(i.flexibleStaked)+" UHT",1)]),o("p",null,[_("Staked (locked): "),o("strong",null,r(i.lockedStaked)+" UHT",1)])]),o("div",Tt,[Ge(o("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=a=>m.value=a),max:i.balance,placeholder:"Enter UHT to stake",class:"stake-input"},null,8,xt),[[Ke,m.value,void 0,{number:!0}]]),o("button",{class:"stake-btn",onClick:De,disabled:m.value<=0||m.value>i.balance},r(q.value?"Staking...":m.value>0?"Stake":"Enter Amount"),9,Dt)]),o("div",Mt,[(v(!0),f(ne,null,he(p.value,(a,n)=>{var l,u;return v(),f("div",{key:n,class:B(["stake-item",{hovered:Z.value===n}]),onMouseenter:c=>Z.value=n,onMouseleave:t[5]||(t[5]=c=>Z.value=-1)},[o("div",null,[o("span",Vt,r(a.type.toUpperCase()),1),o("span",It,": "+r(a.amount)+" UHT",1),a.unlockDate?(v(),f("span",Nt," â€¢ Unlocks: "+r(a.unlockDate),1)):A("",!0),a.unlockReady?A("",!0):(v(),f("div",Et," â³ Unlocks in: "+r(Ue(n)),1))]),o("div",$t,[o("button",{class:"unstake-btn",onClick:c=>Ae(n),disabled:I.value===n||!((l=p.value[n])!=null&&l.unlockReady)},r(I.value===n?"Loading...":(u=p.value[n])!=null&&u.unlockReady?"Withdraw":"Locked"),9,Rt)])],42,At)}),128))]),o("div",Ut,[o("div",{class:"progress",style:we({width:`${xe.value}%`})},null,4)])])],64)):(v(),f("section",wt,"ðŸš€ Staking Coming Soon â€” Stay Tuned!")),Ct,o("div",Lt,[o("p",null,"Total Votes: "+r(ce.value.toLocaleString()),1),o("p",null,"Voting Power: "+r($.value.amount)+" UHT ("+r($.value.type||"none")+")",1),z.value<se(U)?(v(),f("p",Ht,"Voting starts in: "+r(ve(se(U)-z.value)),1)):E.value?(v(),f("p",Wt,"Voting has ended")):(v(),f("p",Ft,"Voting ends in: "+r(ve(se(X)-z.value)),1))]),o("div",zt,[(v(!0),f(ne,null,he(g.value,a=>(v(),f("div",{key:a.id,class:B(["nft-row",{voted:D.value===a.id}]),onMouseenter:n=>re.value=a.id,onMouseleave:t[6]||(t[6]=n=>re.value=null)},[o("div",jt,[o("img",{src:a.img,class:"nft-thumb"},null,8,Bt),o("div",Pt,[o("div",Yt,[_(r(a.name)+" ",1),D.value===a.id?(v(),f("span",qt,"You Voted")):A("",!0)]),o("div",Zt,r(a.votes.toLocaleString())+" votes â€¢ "+r(Re(a)),1),o("div",Qt,[o("div",{class:"fill",style:we({width:a.percent+"%"})},null,4)])])]),o("div",Gt,[o("div",Kt,r(a.available)+" left",1),o("button",{class:"vote-btn",onClick:n=>Le(a.id),disabled:!Ee.value||x.value||E.value},r(He(a.id)),9,Jt)])],42,Ot))),128))]),Xt]),Me.value?(v(),f("div",{key:0,class:"modal-backdrop",onClick:Je(W,["self"])},[o("div",ea,[ta,o("p",null,[_(" You're about to withdraw "),o("strong",null,r(G.value)+" UHT",1),_(" from a "),o("strong",null,r(K.value),1),_(" stake. ")]),J.value?(v(),f("p",oa,"This stake is unlocked â€” you may proceed.")):(v(),f("p",aa," This stake is not yet unlocked. Withdrawal will fail until the unlock date. ")),o("div",na,[o("button",{class:"modal-cancel",onClick:W},"Cancel"),o("button",{class:"modal-confirm",onClick:Ve,disabled:I.value===N.value},r(I.value===N.value?"Withdrawing...":"Confirm Withdraw"),9,sa)])])])):A("",!0)])}}},ia=Se(la,[["__scopeId","data-v-91a7c93f"]]),ca={};function ra(R,h){const Y=ia;return v(),f("div",null,[ge(Y)])}const Sa=Se(ca,[["render",ra]]);export{Sa as default};
